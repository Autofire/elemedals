# Spookat
# 

{
#------GLOBAL VALUES------#
id: "kat_norm",
prototype: ["hittable"],
solid_dimensions: ["common","~enemy", "~hazard"],
collide_dimensions: ["common", "enemy", "~hazard"],
editor_info: { category: "Monsters, Undead" },
hitpoints: 2000,
max_hitpoints: 200,
traction: 1000,

#------PROPERTIES------#
properties: {
	team: "'evil'",
	stand_ticks: { type: "int", default: 2 },
	attack_CD: { type: "int", default: 75 },
	attack_damage: "if(animation = 'attack', 2, 1)",
	cycles_until_idle: { type: "int", defautl: 4 },
	is_a_flier: true,
	
	distance_to_cliff_check: "max(30, (velocity_x*facing)/6)",
		
	should_turn_away_from_cliff: "if(upside_down = -1,
			(distance_to_cliff < distance_to_cliff_check),
			if((not solid(level, midpoint_x + 30*facing, midpoint_y -20, 2, 1)) or solid(level, midpoint_x + 30*facing, midpoint_y -10, 5, 1), 1)
	)",
	
	player_noticeable: "bool :: (player_in_visible_pos and abs(level.player.midpoint_x - self.midpoint_x) < if(self.facing = desired_facing, front_detection_area, rear_detection_area))",
	player_in_target_area:  "if(player_noticeable and self.facing = desired_facing, 1, 0)",
	desired_facing: "int :: if(level.player.midpoint_x < self.midpoint_x, -1, 1)",
	rear_detection_area: "if(higher_difficulty, 1200, 400)",
	front_detection_area: "if(higher_difficulty, 1200, 500)",
	player_in_attack_range: "(abs(level.player.midpoint_x - midpoint_x) < 120)",
	player_in_decent_y_pos: "(level.player.midpoint_y > self.y and level.player.midpoint_y - 16 < self.y2)",
	player_in_visible_pos: "((level.player.midpoint_y + 96 > self.y or level.player.midpoint_y - 96 < self.y2) and (abs(level.player.midpoint_x - midpoint_x) < 180))",
	
	turn_around_check: "commands :: if((should_turn_away_from_cliff), animation('turn'))",
		
	#--AI VS. PLAYER--#
},

#------ANIMATION HANDLES------#
on_create: "[animation('idle'), set(cycles_until_idle, 0)]", #bugfix

on_process_stand: "add(velocity_x, -sign(velocity_x)*1)",

on_end_stand_anim: "[set(velocity_y,-50),
					if(cycles_until_idle <= 0,
						animation('idle'),
						[animation('stand'), add(cycles_until_idle, -1)]
						)
					]",
					
on_process_idle: "switch(time_in_animation,
		1, set(custom_draw, [0.0,1.0,2.0,3.0,[-2,3],[1,3],[2,-2],[-1,-2]]),
		10,set(custom_draw, [0.0,1.0,2.0,3.0,[-1,0],[0,0],[1,0],[0,0]]),
		12,[set(custom_draw, [0.0,1.0,2.0,3.0,[-1,-3],[1,-3],[-1,3],[1,3]]),
				set(velocity_y,-100),
				sound_falloff('Kitty-spotted.wav')],
		16,set(custom_draw, [0.0,1.0,2.0,3.0,[0,-2],[0,-2],[0,1],[0,1]]),
		)",

on_end_idle_anim: "[animation('stand'),
					set(cycles_until_idle, (2d3)+2),
					set(custom_draw, [0.0,1.0,2.0,3.0,[0,0],[0,0],[0,0],[0,0]])
					]",

on_end_hurt_anim: "animation('stand')",

#------ANIMATIONS------#
animation: [
	{
		id: "stand",
		body_area: "all",
		image: "undead/kat_norm.png",
		rect: [2,2,27,36],
		solid_area: [7,7,22,29],
		pad: 3,
		frames: 4,
		frames_per_row: 4,
		duration: 7,
		accel_x: 0,
		accel_y: 4
	},
	
	{
		id: "idle",
		body_area: "all",
		image: "undead/kat_norm.png",
		rect: [124,2,149,36],
		solid_area: [7,7,22,29],
		pad: 3,
		frames: 4,
		frames_per_row: 4,
		duration: 6,
		accel_x: 0,
		accel_y: 4
	},
	
	{
		id: "hurt",
		body_area: "all",
		image: "undead/kat_norm.png",
		rect: [2,2,27,36],
		solid_area: [7,7,22,29],
		pad: 3,
		frames: 4,
		frames_per_row: 4,
		duration: 7,
		accel_x: 0,
		accel_y: 4
	}
]
}
