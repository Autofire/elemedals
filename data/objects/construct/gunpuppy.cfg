{
id: "gunpuppy",
editor_info: { category: "Monsters, Construct" },
friction: 2000,
solid_dimensions: ["common","enemy"],

properties: {
	desired_facing: "if(level.player.midpoint_x < self.midpoint_x, -1, 1)",

	choose_action: "def() if(player_noticeable, animation('direction_check'), animation('stand'))",
	
	player_noticeable: "if(player_in_decent_y_pos and abs(level.player.midpoint_x - self.midpoint_x) < if(self.facing = desired_facing, front_detection_area, rear_detection_area), 1, 0)",
	player_in_target_area:  "if(player_noticeable and self.facing = desired_facing, 1, 0)",
	rear_detection_area: "if(higher_difficulty, 500, 200)",
	front_detection_area: "if(higher_difficulty, 500, 400)",
	
	player_in_decent_y_pos: "if(stair_shot_worth_taking, 1, (level.player.midpoint_y > self.y-player_x_dist and level.player.midpoint_y < self.y2 and abs(slope_standing_on) < 1))",
	player_x_dist: "abs(level.player.mid_x - self.mid_x)/4",
	
	attack_countdown_length: "if(higher_difficulty, 0, 3)",
	
	prepare_to_fire: "def() [animation('open'),sound('kitty-gun-flint'+1d2+'.wav'),set(vars.attack_counter,0)]",
	
	
	stair_shot_worth_taking: "if(slope_standing_on != 0 and player_on_stairs, 1, 0)  where player_on_stairs = if(5 > abs(slope_standing_on - (angle_to(me,level.player)+180*if(facing<0,1,0))), 1, 0)",


	higher_difficulty: "level.player.difficulty > level.player.difficulty_casual",
},

on_end_stand_anim: "choose_action()",
on_end_direction_check_anim: "if(facing != desired_facing,
	    [animation('turn'), set(facing, desired_facing)],
		prepare_to_fire())",

on_end_turn_anim: "choose_action()",
on_end_open_anim: "animation('close')",
on_end_close_anim: "choose_action()",

animation: [
	{
		frames_per_row: 2,

		id: "stand",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,7,26,37],
		solid_area: [3,5,16,29],
		pad: 4,
		frames: 2,
		accel_x: 0,
		accel_y: 80
	},
	{
	# This animation is ran right after noticing the player. It triggers 'turn'
		frames_per_row: 1,
		
		id: "direction_check",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,7,26,37],
			solid_area: [3,5,16,29],
		pad: 4,
		frames: 1,
		accel_x: 0,
		accel_y: 80
	},
	{
		frames_per_row: 1,
		
		id: "turn",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,7,26,37],
		solid_area: [3,5,16,29],
		pad: 4,
		frames: 1,
		accel_x: 0,
		accel_y: 80
	},
	{
		frames_per_row: 3,

		id: "open",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,42,28,72],
		solid_area: [4,5,17,29],
		pad: 4,
		frames: 3,
		duration: 4,
		accel_x: 0,
		accel_y: 80
	},
	{
		frames_per_row: 3,

		id: "close",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,112,28,142],
		solid_area: [4,5,17,29],
		pad: 4,
		frames: 3,
		duration: 4,
		accel_x: 0,
		accel_y: 80
	}
]
}
