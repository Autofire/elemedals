# Gunpuppy (Tier 1)
# Simple turret enemy
# TODO: (This only includes things which may not be obvious)
#	Make special bullets
#	Add turn animation
#	Make it fling the player off if it's stood on for too long

{
#GLOBAL VALUES#

id: "gunpup_norm_T1",
prototype: ["stationary_vulnerable"],
editor_info: { category: "Monsters, Construct" },
solid_dimensions: ["common","enemy"],
hitpoints: 200,
max_hitpoints: 200,

#Note: the last section used to be longer, but after including the prototype,
# "stationary_vulnerable", many of what was defined here became redundant.

properties: {
	desired_facing: "if(level.player.midpoint_x < self.midpoint_x, -1, 1)",

	choose_action: "def() if(player_noticeable, animation('direction_check'), animation('stand'))",
	
	player_noticeable: "if(player_in_decent_y_pos and abs(level.player.midpoint_x - self.midpoint_x) < if(self.facing = desired_facing, front_detection_area, rear_detection_area), 1, 0)",
	player_in_target_area:  "if(player_noticeable and self.facing = desired_facing, 1, 0)",
	rear_detection_area: "if(higher_difficulty, 500, 200)",
	front_detection_area: "if(higher_difficulty, 500, 400)",
	
	player_in_decent_y_pos: "if(stair_shot_worth_taking, 1, (level.player.midpoint_y > self.y-player_x_dist and level.player.midpoint_y < self.y2 and abs(slope_standing_on) < 1))",
	player_x_dist: "abs(level.player.mid_x - self.mid_x)/4",
	
	attack_countdown_length: "if(higher_difficulty, 0, 3)",
	
	prepare_to_fire: "def() [animation('open'),sound('kitty-gun-flint'+1d2+'.wav'),set(vars.attack_counter,0)]",
	
	
	stair_shot_worth_taking: "if(slope_standing_on != 0 and player_on_stairs, 1, 0)  where player_on_stairs = if(5 > abs(slope_standing_on - (angle_to(me,level.player)+180*if(facing<0,1,0))), 1, 0)",


	higher_difficulty: "level.player.difficulty > level.player.difficulty_casual",
},

#ANIMATION HANDLES#
on_end_stand_anim: "choose_action()",
on_end_direction_check_anim: "if(facing != desired_facing,
	    [animation('turn'), set(facing, desired_facing)],
		prepare_to_fire())",

on_end_turn_anim: "choose_action()",
on_end_open_anim: "animation('fire')",
on_end_fire_anim: "animation('close')",
on_end_close_anim: "choose_action()",

on_shoot: "[spawn('gunpup_norm_T1.gunpup_bullet', midpoint_x+ facing*5, midpoint_y - 13, facing, [
	set(rotate, slope_standing_on),
	set(velocity_x, 800 * cos(slope_standing_on) * facing),
	set(velocity_y, 1200 * sin(slope_standing_on) * facing +1d200-150)]),
	spawn('kitty_gun.muzzle_flash', midpoint_x+ facing*50, midpoint_y -2, facing),sound('cannon.ogg')]",

#ANIMATIONS#
animation: [
	{
		frames_per_row: 2,

		id: "stand",
		body_area: "all",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,7,26,33],
		solid_area: [3,3,16,25],
		pad: 4,
		frames: 2,
		accel_x: 0,
		accel_y: 100
	},
	{
	# This animation is ran right after noticing the player. It triggers 'turn'
		frames_per_row: 1,
		
		id: "direction_check",
		body_area: "all",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,7,26,37],
		solid_area: [3,5,16,29],
		pad: 4,
		frames: 1,
		accel_x: 0,
		accel_y: 100
	},
	{
		frames_per_row: 1,
		
		id: "turn",
		body_area: "all",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,7,26,37],
		solid_area: [3,5,16,29],
		pad: 4,
		frames: 1,
		accel_x: 0,
		accel_y: 100
	},
	{
		frames_per_row: 3,

		id: "open",
		body_area: "all",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,42,28,72],
		solid_area: [4,5,17,29],
		pad: 4,
		frames: 3,
		duration: 4,
		accel_x: 0,
		accel_y: 100
	},
	{
		frames_per_row: 3,

		id: "fire",
		body_area: "all",
		events: "1:shoot",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,77,28,107],
		solid_area: [4,5,17,29],
		pad: 4,
		frames: 1,
		duration:50,
		accel_x: 0,
		accel_y: 100
	},
	{
		frames_per_row: 3,

		id: "close",
		body_area: "all",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,112,28,142],
		solid_area: [4,5,17,29],
		pad: 4,
		frames: 3,
		duration: 4,
		accel_x: 0,
		accel_y: 100
	},
	{
		frames_per_row: 2,

		id: "shake",
		body_area: "all",
		image: "construct/gunpup_norm_T1.png",
		rect: [5,7,26,37],
		solid_area: [3,5,16,29],
		pad: 4,
		frames: 2,
		accel_x: 0,
		accel_y: 100
	}
],

# Bullets and effects
object_type: [
		{
		id: "gunpup_bullet",
		dies_on_inactive: true,
		timer_frequency: 450,
		object_level_collisions: true,
		solid_dimensions: ["player"],
		prototype: ["shot"],
		properties: {
			attack_damage: "if(level.player.difficulty <= level.player.difficulty_casual,1,2)",
		},
		on_end_normal_anim: "animation('normal2')",
		on_end_normal2_anim: "animation('normal2')",
		on_end_flash_anim: "die()",
		on_timer: "die()",
		animation: [
			{
				image: "effects/explosion2.png",
				attack_area: [0,0,11,11],
				pad: 3,
				id: "normal",
				rect: [1,79,20,93],
				frames: 2,
				frames_per_row: 1,
				duration: 1,
			},
			{
				image: "effects/explosion2.png",
				attack_area: [0,0,11,11],
				pad: 3,
				id: "normal2",
				rect: [24,79,43,93],
				frames: 2,
				frames_per_row: 1,
				duration: 2,
			},
		],
	},
	]
}
