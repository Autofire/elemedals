# Shankle
# Invincible Goomba-clone
# TODO: (This only includes things which may not be obvious)
# Use sound which doesn't come from Frogatto

{
#GLOBAL VALUES#
id: "shankle",
editor_info: {
	category: "Hazards",
	
	var: [
		{
			name: "falls_down",
			type: "boolean",
			value: "1",
		},
	],
	},
prototype: ["hittable"],
solid_dimensions: ["common","~enemy", "~hazard"],
collide_dimensions: ["common", "enemy", "~hazard"],
hitpoints: 200,
max_hitpoints: 200,
traction: 500,
friction: 50,

is_strict: false,

# set the gravity
on_editor_changed_variable: "if(falls_down, set('upside_down', -1), set('upside_down', 1))",
on_create: "if(falls_down, set('upside_down', -1), set('upside_down', 1))",
accel_x: 0,

properties: {
	team: "'evil'",
	attack_damage: 1,
	attack_damage_to_player: 1,
	
	clank: "def() -> commands
			sound('metal-ball-bounce'+1d3+'.wav', 250 + 1d2500)",
	
	gst: 2,	# Global Stand Time; number of times the stand animation plays
	
	distance_to_cliff_check: "max(30, velocity_x/7)",
		
	should_turn_away_from_cliff: "if(upside_down = -1,
			(distance_to_cliff < distance_to_cliff_check),
			if((not solid(level, midpoint_x + 30*facing, midpoint_y -20, 2, 1)) or solid(level, midpoint_x + 30*facing, midpoint_y -10, 5, 1), 1)
	)",
	
	turn_around_check: "def() -> commands
			if((should_turn_away_from_cliff), [animation('stand'), set(facing, -facing), set(standtime, gst), set(velocity_x,0),clank()])",
			
	handle_damage_type_modifications: "def(string damage_type, int amount) -> int
			switch(damage_type, 'acid', amount, 0)",
},

#ANIMATION HANDLES#
on_process: "[set('accel_y', (-100 * upside_down)), turn_around_check()]",
on_collide_side: "[animation('stand'), set(facing, -facing), set(standtime,gst), set(velocity_x,0), clank()]",
on_end_stand_anim: "[set(standtime, standtime - 1), if(standtime = 0, animation('walk'),animation('stand'))]",
on_end_walk_anim: "animation('walk')",

#ANIMATIONS#
animation: [
	{
		frames_per_row: 1,

		id: "walk",
		body_area: "all",
		image: "hazard/spikies.png",
		rect: [3,2,38,15],
		solid_area: [5,3,30,12],
		pad: 3,
		frames: 4,
		reverse: true,
		duration: 2,
		velocity_x: 250,
		attack_area: [1,1,34,14]
	},
	
	{
		frames_per_row: 1,

		id: "stand",
		body_area: "all",
		image: "hazard/spikies.png",
		rect: [3,2,38,15],
		solid_area: [5,3,30,12],
		pad: 3,
		frames: 4,
		duration: 4,
		attack_area: [1,1,34,14]
	},
]
}
