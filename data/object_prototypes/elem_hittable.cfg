# This prototype is for Elemedals, which builds off 
#  Frogatto's hittable prototype.
#
# This prototype handles all of the statuses, dmg
#  types, and effects that appear in the game.

# Add this line to objects calling this one.
#  on_process: "proto_event('elem_hittable', 'process')"

{
id: "elem_hittable",
prototype: ["hittable"],

properties: {
	energy: { type: "int", default: 80 },

# ----- DAMAGE VARS ----- #
	shadow_dmg: { type: "int", default: 0 },
	
#elemental_dmg: { type: "int", default: 0 },
# Elemental is an instant effect
	
	pierce_dmg: { type: "int", default: 0 },
	old_midpoint_x: { type: "int", default: 0 },
	pierce_interval: { type: "int", default: 50 },
	
# ----- STATUS VARS ----- #
	

# ----- HEALING ----- #
	heal: "def(int heal_amount) -> commands
		if(me.hitpoints + heal_amount >= me.max_hitpoints - me.shadow_dmg,
			set(me.hitpoints, me.max_hitpoints - me.shadow_dmg),
			set(me.hitpoints, me.hitpoints + heal_amount)
		)",
},

# ----- PROCESS ----- #
on_process: "if(me.cycle % 50 = 0, [
	if(me.shadow_dmg > 0, add(me.shadow_dmg, -1)),
	
	add(me.hitpoints, - abs(me.midpoint_x - me.old_midpoint_x) / me.pierce_interval),
	if(me.pierce_dmg > 0, add(me.pierce_dmg, -1)),
	set(me.old_midpoint_x, me.midpoint_x),
	debug(shadow_dmg),
	debug('hi'),
	
	if(me.energy < 100, add(me.energy, 1)),
	], debug(me.cycle))",
}
